<hr class="mt-3">

{# å½“å‰æ¯”èµ›é˜¶æ®µæ ‡ç­¾ï¼Œç”¨äºæç¤ºæ–‡å­— #}
{% set stage_label = 'æµ·é€‰æ¯”èµ›' %}
{% if player.promotion_status == 'revival' %}
    {% set stage_label = 'å¤æ´»èµ›' %}
{% elif player.promotion_status == 'top16' %}
    {% set stage_label = '16è¿›8æ¯”èµ›' %}
{% elif player.promotion_status == 'top8' %}
    {% set stage_label = '8è¿›4æ¯”èµ›' %}
{% elif player.promotion_status == 'top4' %}
    {% set stage_label = '4å¼ºèµ›' %}
{% endif %}

{# æ˜¯å¦å…è®¸å½“å‰è½®ç”±é€‰æ‰‹è‡ªå·±æäº¤æˆç»©ï¼ˆä»…æµ·é€‰ + å¤æ´»èµ›ï¼‰ #}
{% set submit_phase = '' %}
{% if (player.promotion_status in ['none', 'eliminated'] and player.score_round1 is none) %}
    {% set submit_phase = 'round1' %}
{% elif player.promotion_status == 'revival' and player.score_revival is none %}
    {% set submit_phase = 'revival' %}
{% endif %}

{% if player.promotion_status == 'eliminated' %}
    <div class="alert alert-danger mb-3">
        <h5 class="mb-1">å·²æ·˜æ±°ï¼Œæ— æ³•ä¸Šæœº</h5>
        <p class="small mb-0">æ‚¨å½“å‰ä¸ºæ·˜æ±°çŠ¶æ€ï¼Œä¸Šæœº/ä¸‹æœºæ“ä½œå·²ç¦ç”¨ã€‚</p>
    </div>
{% elif player.on_machine %}
    <div class="alert alert-warning mb-3">
        <h5 class="mb-1">ğŸ® {{ stage_label }}ä¸­...</h5>

        {% if submit_phase %}
            <p class="small mb-2">
                æœ¬è½®ç»“æŸåï¼Œè¯·åœ¨ä¸‹æ–¹è¾“å…¥æœ¬è½®æˆç»©å¹¶æäº¤ï¼›æäº¤æˆåŠŸåå°†è‡ªåŠ¨ä¸‹æœºã€‚
            </p>
            <form method="POST" action="{{ url_for('submit_score') }}" class="mt-2">
                <input type="hidden" name="name" value="{{ player.name }}">
                <input type="hidden" name="phase" value="{{ submit_phase }}">
                <input type="number" name="score" class="form-control mb-2"
                       placeholder="è¯·è¾“å…¥æœ¬è½®æˆç»©ï¼ˆæ•°å­—ï¼‰" required step="any">
                <button type="submit" class="btn btn-success w-100">
                    æäº¤æˆç»©å¹¶ä¸‹æœº
                </button>
            </form>
        {% else %}
            <p class="small mb-2">
                æœ¬è½®æ¯”èµ›ç”±è£åˆ¤è®°å½•èƒœè´Ÿç»“æœï¼Œæ‚¨æ— éœ€è‡ªè¡Œæäº¤æˆç»©ã€‚è¯·åœ¨å¯¹å±€ç»“æŸåå‘ŠçŸ¥è£åˆ¤ã€‚
            </p>
        {% endif %}

    <form method="POST" action="{{ url_for('toggle_machine') }}" class="mt-2">
        <input type="hidden" name="name" value="{{ player.name }}">
        <button type="submit" class="btn btn-outline-secondary w-100 btn-sm" id="btn-machine-toggle">
            <i class="bi bi-stop-circle me-1"></i> ä¸‹æœº / ç»“æŸå½“å‰å¯¹å±€
        </button>
    </form>
</div>
{% else %}
<div class="alert alert-info mb-3">
    <h5 class="mb-1">ç­‰å¾…å«å·ä¸Šæœº</h5>
    <p class="small mb-0" id="machine-status-text">
        å½“è£åˆ¤å«åˆ°æ‚¨çš„åºå·è¿›å…¥ {{ stage_label }} æ—¶ï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ç¡®è®¤ä¸Šæœºã€‚
    </p>
</div>
<form method="POST" action="{{ url_for('toggle_machine') }}">
    <input type="hidden" name="name" value="{{ player.name }}">
    <button type="submit" class="btn btn-primary btn-lg w-100" id="btn-machine-toggle" {% if player.promotion_status == 'eliminated' %}disabled{% endif %}>
        <i class="bi bi-play-circle me-1"></i> ç¡®è®¤ä¸Šæœº
    </button>
</form>
{% endif %}
